Case study
==========

.. note::

   The following tutorial is intended to be run entirely with Python 3.

.. _obtaining_the_files:

Obtaining the files
-------------------

In the case you haven't created the working directory, run the following:

``On Windows:``

.. code-block:: python
   
  import subprocess
  subprocess.run('wsl bash -c "mkdir /mnt/c/Agri-Plast"', shell=True, check=True)

``On Linux/Mac:``

.. code-block:: python

  import subprocess
  subprocess.run('mkdir ~/Agri-Plast', shell=True, check=True)

In this case study we'll be focusing on the following dataset:
`https://dmportal.biodata.pt/dataset.xhtml?persistentId=doi:10.34636/DMPortal/Q3YLV4 <https://dmportal.biodata.pt/dataset.xhtml?persistentId=doi:10.34636/DMPortal/Q3YLV4>`_

Take note of the doi:

.. code-block:: console

  doi:10.34636/DMPortal/Q3YLV4

Run the following to obtain the metadata file:

``On Windows:``

.. code-block:: python
   
  import subprocess
  doi = "doi:10.34636/DMPortal/Q3YLV4"
  subprocess.run(f'wsl bash -c "curl -L \\"https://dmportal.biodata.pt/api/datasets/:persistentId/?persistentId={doi}\\" -o /mnt/c/Agri-Plast/dataset.metadata"', shell=True, check=True)

``On Linux/Mac:``

.. code-block:: python

  import subprocess
  doi = "doi:10.34636/DMPortal/Q3YLV4"
  subprocess.run("TBA")

Searching for the ID following ``"dataFile":{"id":`` the following IDs are identified: ``1231`` and ``1232``. Run the following to obtain both files:

``On Windows:``

.. code-block:: python

   import subprocess
   id = "1231"
   subprocess.run(f'wsl bash -c "curl -L \\"https://dmportal.biodata.pt/api/access/datafile/{id}?format=original\\" -o /mnt/c/Agri-Plast/file_{id}.csv"', shell=True, check=True)
   id = "1232"
   subprocess.run(f'wsl bash -c "curl -L \\"https://dmportal.biodata.pt/api/access/datafile/{id}?format=original\\" -o /mnt/c/Agri-Plast/file_{id}.csv"', shell=True, check=True)

``On Linux/Mac:``

.. code-block:: python

   import subprocess
   id = "1231"
   subprocess.run("TBA", shell=True, check=True)
   id = "1232"
   subprocess.run("TBA", shell=True, check=True)

We can now look at the first file:

.. code-block:: python

   import pandas as pd
   dataset = pd.read_csv("C:\\Agri-Plast\\file_1231.csv") # Change for ~/Agri-Plast/file_1231.csv on Linux/Mac
   print(dataset.head(10))

``Output:``

.. code-block:: console

      ID   Treatment       Log Time Start Time Finish  \
   0  58     Control   Log (4)      11h26       11h36   
   1  62     Control   Log (5)      11h36       11h46   
   2  19     Control   Log (8)      12h13       12h23   
   3   5     Control   Log (9)      12h24       12h34   
   4  18     Control  Log (14)      13h26       13h36   
   5  13     Control  Log (15)      13h40       13h50   
   6  39  High [MPs]   Log (1)      10h50       11h00   
   7  30  High [MPs]   Log (7)      12h01       12h11   
   8  40  High [MPs]  Log (10)      12h37       12h47   
   9  28  High [MPs]  Log (13)      13h15       13h25   
   
      Gas Exchange (A) (µmol m⁻² s⁻¹)  \
   0                            2.510   
   1                            5.399   
   2                            6.747   
   3                            5.448   
   4                            7.651   
   5                            4.337   
   6                            3.947   
   7                            4.025   
   8                            5.975   
   9                            6.234   
   
      Stomatal conductance (Gsw)  (µmol m⁻² s⁻¹)        Date Observations  
   0                                    0.028545  03/07/2024   Before MPs  
   1                                    0.003452  03/07/2024   Before MPs  
   2                                    0.031398  03/07/2024   Before MPs  
   3                                    0.044850  03/07/2024   Before MPs  
   4                                    0.040487  03/07/2024   Before MPs  
   5                                    0.060281  03/07/2024   Before MPs  
   6                                    0.019934  03/07/2024   Before MPs  
   7                                    0.031952  03/07/2024   Before MPs  
   8                                    0.040976  03/07/2024   Before MPs  
   9                                    0.060094  03/07/2024   Before MPs

.. _stomatal_conductance:

Stomatal Conductance
--------------------

To start, a boxplot of the Stomatal conductance by Microplastic concentration will be generated by running the following lines:

.. code-block:: python

   import pandas as pd
   import matplotlib.pyplot as plt
   dataset = pd.read_csv("C:\\Agri-Plast\\file_1231.csv")
   order = ["Control", "Low [MPs]", "High [MPs]"]
   dataset["Treatment"] = pd.Categorical(dataset["Treatment"], categories=order, ordered=True)
   dataset.boxplot(
       column="Stomatal conductance (Gsw)  (µmol m⁻² s⁻¹)", 
       by="Treatment"
   )
   plt.title("Stomatal Conductance by Treatment")
   plt.xlabel("Treatment")
   plt.suptitle("")
   plt.ylabel("Stomatal Conductance (Gsw)")
   plt.show()




